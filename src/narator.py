from kt403A import KT403A
import common

class Word:
    def __init__(self, f, duration):
        self.file = f
        self.duration = duration

word_to_file = {
    '0': Word(1, 630),
    '1': Word(2, 710),
    '2': Word(3, 760),
    '3': Word(4, 680),
    '4': Word(5, 710),
    '5': Word(6, 710),
    '6': Word(7, 760),
    '7': Word(8, 860),
    '8': Word(9, 650),
    '9': Word(10, 760),
}

sentence_to_word = {
    "-15": ['-', '1', '5'],
    "-14": ['-', '1', '4'],
    "-13": ['-', '1', '3'],
    "-12": ['-', '1', '2'],
    "-11": ['-', '1', '1'],
    "-10": ['-', '1', '0'],
    "-9": ['-', '9'],
    "-8": ['-', '8'],
    "-7": ['-', '7'],
    "-6": ['-', '6'],
    "-5": ['-', '5'],
    "-4": ['-', '4'],
    "-3": ['-', '3'],
    "-2": ['-', '2'],
    "-1": ['-', '1'],
    "0": ['0'],
    "1": ['1'],
    "2": ['2'],
    "3": ['3'],
    "4": ['4'],
    "5": ['5'],
    "6": ['6'],
    "7": ['7'],
    "8": ['8'],
    "9": ['9'],
    "10": ['1', '0'],
    "11": ['1', '1'],
    "12": ['1', '2'],
    "13": ['1', '3'],
    "14": ['1', '4'],
    "15": ['1', '5'],
    "16": ['1', '6'],
    "17": ['1', '7'],
    "18": ['1', '8'],
    "19": ['1', '9'],
    "20": ['2', '0'],
    "21": ['2', '1'],
    "22": ['2', '2'],
    "23": ['2', '3'],
    "24": ['2', '4'],
    "25": ['2', '5'],
    "26": ['2', '6'],
    "27": ['2', '7'],
    "28": ['2', '8'],
    "29": ['2', '9'],
    "30": ['3', '0'],
    "31": ['3', '1'],
    "32": ['3', '2'],
    "33": ['3', '3'],
    "34": ['3', '4'],
    "35": ['3', '5'],
    "36": ['3', '6'],
    "37": ['3', '7'],
    "38": ['3', '8'],
    "39": ['3', '9'],
    "40": ['4', '0'],
    "41": ['4', '1'],
    "42": ['4', '2'],
    "43": ['4', '3'],
    "44": ['4', '4'],
    "45": ['4', '5'],
    "46": ['4', '6'],
    "47": ['4', '7'],
    "48": ['4', '8'],
    "49": ['4', '9'],
    "50": ['5', '0'],
    "51": ['5', '1'],
    "52": ['5', '2'],
    "53": ['5', '3'],
    "54": ['5', '4'],
    "55": ['5', '5'],
    "56": ['5', '6'],
    "57": ['5', '7'],
    "58": ['5', '8'],
    "59": ['5', '9'],
    "60": ['6', '0'],
    "61": ['6', '1'],
    "62": ['6', '2'],
    "63": ['6', '3'],
    "64": ['6', '4'],
    "65": ['6', '5'],
    "66": ['6', '6'],
    "67": ['6', '7'],
    "68": ['6', '8'],
    "69": ['6', '9'],
    "70": ['7', '0'],
    "71": ['7', '1'],
    "72": ['7', '2'],
    "73": ['7', '3'],
    "74": ['7', '4'],
    "75": ['7', '5'],
    "76": ['7', '6'],
    "77": ['7', '7'],
    "78": ['7', '8'],
    "79": ['7', '9'],
    "80": ['8', '0'],
    "81": ['8', '1'],
    "82": ['8', '2'],
    "83": ['8', '3'],
    "84": ['8', '4'],
    "85": ['8', '5'],
    "86": ['8', '6'],
    "87": ['8', '7'],
    "88": ['8', '8'],
    "89": ['8', '9'],
    "90": ['9', '0'],
    "91": ['9', '1'],
    "92": ['9', '2'],
    "93": ['9', '3'],
    "94": ['9', '4'],
    "95": ['9', '5'],
    "96": ['9', '6'],
    "97": ['9', '7'],
    "98": ['9', '8'],
    "99": ['9', '9'],
    "100": ['1', '0', '0'],
    "101": ['1', '0', '1'],
    "102": ['1', '0', '2'],
    "103": ['1', '0', '3'],
    "104": ['1', '0', '4'],
    "105": ['1', '0', '5'],
    "106": ['1', '0', '6'],
    "107": ['1', '0', '7'],
    "108": ['1', '0', '8'],
    "109": ['1', '0', '9'],
    "110": ['1', '1', '0'],
    "111": ['1', '1', '1'],
    "112": ['1', '1', '2'],
    "113": ['1', '1', '3'],
    "114": ['1', '1', '4'],
    "115": ['1', '1', '5'],
    "116": ['1', '1', '6'],
    "117": ['1', '1', '7'],
    "118": ['1', '1', '8'],
    "119": ['1', '1', '9'],
    "120": ['1', '2', '0'],
    "121": ['1', '2', '1'],
    "122": ['1', '2', '2'],
    "123": ['1', '2', '3'],
    "124": ['1', '2', '4'],
    "125": ['1', '2', '5']
}

speaker = KT403A(volume=100)
word_queue = []
wait_for_duration_timestamp = common.get_millis()


def is_playing():
    return speaker.IsPlaying()


@common.dump_func(showarg=True)
def play(index):
    speaker.PlaySpecific(index)


@common.dump_func(showarg=True)
def sentence_to_files(sentence):
    files = []
    for word in sentence_to_word[sentence]:
        files.append(word_to_file[word])
    return files


@common.dump_func(showarg=True)
def play_sentence(sentence):
    for f in sentence_to_files(sentence):
        word_queue.append(f)


def loop():
    global wait_for_duration_timestamp
    if len(word_queue) > 0 and common.millis_passed(wait_for_duration_timestamp) > word_queue[0].duration and not is_playing():
            wait_for_duration_timestamp = common.get_millis()
            word = word_queue.pop(0)
            play(word.file)


def loop_test():
    while(True):
        loop()
